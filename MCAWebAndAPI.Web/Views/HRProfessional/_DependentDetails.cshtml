@using MCAWebAndAPI.Model.ViewModel.Form.HR

@model IEnumerable<DependentDetailVM>

<div class="col-sm-12">

    @(Html.Kendo().Grid(Model)
    .Name("DependentDetails")
    .ToolBar(tools => tools.Create().Text("Add New Dependent"))
    .Editable(editable => editable.Mode(GridEditMode.InCell)
    .CreateAt(GridInsertRowPosition.Bottom))
    .Columns(columns =>
    {
        columns.Bound(p => p.FullName).ClientTemplate("#= FullName #" +
        "<input type='hidden' name='DependentDetails[#= getDependentDetail(data)#].FullName' value='#= FullName #' />"
        );
        columns.Bound(p => p.Relationship).ClientTemplate("#= Relationship.Text #" +
        "<input type='hidden' name='DependentDetails[#= getDependentDetail(data)#].Relationship' value='#= Relationship #' />"
        ).EditorViewData(new { BindTo = DependentDetailVM.GetRelationshipOptions() });
        columns.Bound(p => p.PlaceOfBirth).ClientTemplate("#= PlaceOfBirth #" +
        "<input type='hidden' name='DependentDetails[#= getDependentDetail(data)#].PlaceOfBirth' value='#= PlaceOfBirth #' />"
        );
        columns.Bound(p => p.DateOfBirth).ClientTemplate("#= kendo.toString(DateOfBirth, 'y') #" +
        "<input type='hidden' name='DependentDetails[#= getDependentDetail(data)#].DateOfBirth' value='#= DateOfBirth #' />"
        );
        columns.Bound(p => p.InsuranceNumber).ClientTemplate("#= InsuranceNumber #" +
        "<input type='hidden' name='DependentDetails[#= getDependentDetail(data)#].InsuranceNumber' value='#= InsuranceNumber #' />"
        );
        columns.Bound(p => p.Remark).ClientTemplate("#= Remark #" +
        "<input type='hidden' name='DependentDetails[#= getDependentDetail(data)#].Remark' value='#= Remark #' />"
        );
        columns.Bound(p => p.ID).Hidden().ClientTemplate("#= ID #" +
        "<input type='hidden' name='DependentDetails[#= getDependentDetail(data)#].ID' value='#= ID #' />"
        );

        columns.Bound(p => p.EditMode).Width(100)
        .ClientTemplate("<button id='DependentDetails[#= getDependentDetail(data)#].DeleteButton'" +
        "class='btn btn-danger' type='button'" +
        "onclick='onDeleteKendoDetail(event)'>Delete</button>" +
        "<input type='hidden' name='DependentDetails[#= getDependentDetail(data)#].EditMode' value='#= EditMode #'/>");
    })
    .Events(e =>
    {
        e.Edit("onEditKendoDetail");
    })
    .DataSource(dataSource => dataSource.Ajax()
    .Model(model =>
    {
        model.Id(p => p.ID);
        model.Field(m => m.Relationship).DefaultValue(DependentDetailVM.GetRelationshipDefaultValue());
        model.Field(m => m.DateOfBirth).DefaultValue(DateTime.Now.AddYears(-10));
    })
    .ServerOperation(false)
    )
    )
</div>

<script>
    function getDependentDetail(dataItem) {
        var data = $("#DependentDetails").data("kendoGrid").dataSource.data();
        return data.indexOf(dataItem);
    }
</script>
